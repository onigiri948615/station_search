# 駅名縦クロスワード検索ツール

日本全国の駅データを使用して、縦クロスワードパズル用の駅名組み合わせを検索するStreamlitアプリケーションです。

## 概要

このツールは、入力された文字列の各文字が「駅名内で同じ位置（インデックス）」に現れる駅の組み合わせを検索します。例えば「あいう」と入力すると、同じ文字位置（例：2文字目）に「あ」「い」「う」がそれぞれある駅を見つけ出し、縦クロスワードパズルの作成に役立てることができます。

## 機能

### 🔍 **検索機能**
- **文字位置一致検索**: 検索文字列の各文字が駅名内で同じ位置に現れる駅を検索
- **カタカナ処理切り替え**: カタカナを別文字として扱うか、ひらがなに変換するかを選択可能
- **地方・都道府県絞り込み**: 特定の地方や都道府県に検索範囲を限定可能
- **入力の都度自動再検索**: 文字入力や設定変更時に自動的に検索を実行

### 📊 **結果表示**
- **位置別グループ化**: 文字位置ごとに結果を整理して表示
- **詳細情報**: 駅名、都道府県、事業者、路線名を含む包括的な情報
- **視覚的区別**: 選択地域内と全国の駅を色分けで区別
- **対応文字表示**: 実際の駅名に含まれる文字（ひらがな/カタカナ/漢字）を表示

### 💾 **データ出力**
- **CSVダウンロード**: 検索結果をCSV形式でエクスポート
- **カスタムデータ対応**: 独自のCSVファイルをアップロードして使用可能

## データソース

- **駅データ**: [駅データ.jp（ekidata.jp）](https://ekidata.jp/) のオープンデータを使用
- **収録件数**: 約10,000件の駅データ（2025年6月時点）
- **含まれる情報**: 駅名、都道府県、路線コード、事業者情報

## 必要なファイル

```
station_search/
├── station_search_gui.py      # メインアプリケーション
├── master_data.py             # 地方・都道府県マッピングデータ
├── station20250604free.csv    # 駅データ（メイン）
├── eki.csv                    # 路線・事業者データ
└── README.md                  # このファイル
```

## インストール・セットアップ

### 動作環境・依存関係

**システム要件**
- **オペレーティングシステム**: Windows 10/11, macOS, Linux（Streamlit対応OS）
- **Python**: 3.9以上（動作確認済み）
- **メモリ**: 最低1GB（推奨2GB以上）

**必要なPythonライブラリ**
- **streamlit**: Webアプリケーションフレームワーク（1.0.0以上）
- **pandas**: データ処理・分析ライブラリ（1.3.0以上）
- **jaconv**: 日本語文字変換ライブラリ（ひらがな⇔カタカナ⇔ローマ字変換）

### 1. 必要なライブラリのインストール

```bash
pip install streamlit pandas jaconv
```

### 2. データファイルの準備

以下のファイルが同一ディレクトリに必要です：
- `station20250604free.csv` - 駅データ
- `eki.csv` - 路線・事業者データ
- `master_data.py` - 地方区分マッピング

### 3. 高速インデックスの作成（推奨）

検索速度を大幅に向上させるため、事前にインデックスを作成できます：

```bash
python create_index.py
```

これにより以下のファイルが生成されます：
- `station_hiragana_index.json` - ひらがな/漢字検索用インデックス
- `station_katakana_index.json` - カタカナ検索用インデックス  
- `station_data_indexed.csv` - 軽量化された駅データ

### 4. アプリケーションの起動

```bash
streamlit run station_search_gui.py
```

ブラウザが自動で開き、`http://localhost:8501` でアプリケーションにアクセスできます。

インデックスファイルが存在する場合、自動的に高速検索モードで動作します。

## 使用方法

### 基本的な検索

1. **検索文字列入力**: ひらがな、漢字で検索したい文字列を入力（最大20文字）
2. **カタカナ処理設定**: 
   - オフ（デフォルト）: カタカナをひらがなに変換して検索
   - オン: カタカナを別文字として扱う
3. **地域選択**（オプション）: 特定の地方や都道府県を選択して検索範囲を限定
4. **結果確認**: 位置別に整理された検索結果を確認

### 検索例

**例1: 「しの」で検索**
```
検索文字列: しの
結果: 同じ位置（例：2文字目）に「し」と「の」がある駅の組み合わせ
- 2文字目での組み合わせ
  - 上野（の） - 2文字目が「の」
  - 品川（な） - 2文字目が「な」（該当なし）
  - 旭川（し） - 2文字目が「し」
```

**例2: 地域限定検索**
```
検索文字列: あいう
地域選択: 関東地方
結果: 関東地方内で同じ位置に「あ」「い」「う」がある駅の組み合わせ
```

## 注意事項

⚠️ **重要な注意事項**
- 検索結果通りに駅名が印字されるとは限りません
- 鉄道会社によって印字の方法が異なる場合があります
- 検索結果の文字表示は駅名データの元の文字種（ひらがな/カタカナ/漢字）に依存します
- 設定に関わらず、実際の表示文字が期待と異なる場合があります

## 技術仕様

### 開発環境
- **Python**: 3.9以上（動作確認済み）
- **フレームワーク**: Streamlit
- **主要ライブラリ**: pandas, jaconv

### アーキテクチャ
- **検索アルゴリズム**: 文字位置別インデックス検索
- **データ処理**: pandas DataFrame操作
- **文字正規化**: jaconv（ひらがな・カタカナ変換）
- **UI**: Streamlit Webアプリケーション

### パフォーマンス
- **データ件数**: 約9,900件（station20250604free.csv）
- **検索応答**: 通常1-3秒（データ規模により変動）
- **メモリ使用量**: 約50-100MB

## ファイル構成詳細

### データファイル仕様

**station20250604free.csv（必須）**
- **必須項目**: 
  - 駅名（ひらがな表記）: 検索処理に使用
  - 駅名（漢字表記）: 表示用
  - 都道府県コード: 地域フィルタリングに使用
- **オプション項目**: 
  - 路線名、事業者名、その他の駅情報（表示のみに使用）
- **データ件数**: 約10,000件（2025年6月4日版）

**eki.csv（オプション）**
- **用途**: 路線・事業者の詳細情報補完（ある場合のみ使用）
- **内容**: 路線コード、事業者コードと名称のマッピング

**master_data.py（必須）**
- **用途**: 地方区分と都道府県コードのマッピング定義
- **内容**: 8地方区分の都道府県コード配列

### `station_search_gui.py`
メインアプリケーションファイル。以下の機能を含む：
- Streamlit UI定義
- 検索ロジック実装
- データ処理・結果表示
- CSVダウンロード機能

### `master_data.py`
地方区分と都道府県コードのマッピングデータ：
```python
REGION_MAPPING = {
    '北海道地方': [1],
    '東北地方': [2, 3, 4, 5, 6, 7],
    '関東地方': [8, 9, 10, 11, 12, 13, 14],
    # ...
}
```

### データファイル
- **station20250604free.csv**: 駅マスターデータ（駅名、都道府県コード、路線コードなど）
- **eki.csv**: 路線・事業者マスターデータ（路線コード、路線名、事業者名など）

## カスタマイズ

### 独自データの使用
1. CSVファイルアップロード機能を使用
2. 必要な列: `station_name`, `pref_cd`, `line_cd`
3. 路線情報が不要な場合は`eki.csv`なしでも動作

### 検索条件の調整
- `normalize_search_string()`: 文字正規化ロジック
- `find_character_positions_cross_with_priority()`: 検索アルゴリズム
- 最大文字数制限: 現在20文字（変更可能）

## トラブルシューティング

### よくある問題

**Q: アプリケーションが起動しない**
```bash
# ライブラリの再インストール
pip install --upgrade streamlit pandas jaconv

# ポート競合の場合
streamlit run station_search_gui.py --server.port 8502
```

**Q: データファイルが見つからない**
- `station20250604free.csv`と`eki.csv`が同一ディレクトリに配置されていることを確認
- ファイル名の大文字小文字を確認

**Q: 検索結果が表示されない**
- 検索文字列が適切な文字種（ひらがな・漢字）であることを確認
- カタカナ処理設定を変更して再試行

**Q: メモリ不足エラー**
- データサイズが大きい場合は、地域限定検索を使用
- 不要なアプリケーションを終了してメモリを確保

## ライセンス

このソフトウェアは自由にご利用いただけます。データソース（駅データ.jp）の利用規約に従ってご使用ください。

## 貢献・改善提案

バグ報告や機能改善の提案を歓迎します。

## 更新履歴

- **v1.0** (2025年7月): 初回リリース
- 基本的なクロスワード検索機能
- 地方・都道府県絞り込み機能
- カタカナ処理切り替え機能
- CSVダウンロード機能

---

**データ提供**: [駅データ.jp](https://ekidata.jp/)  
**最終更新**: 2025年7月